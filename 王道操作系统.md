## 王道操作系统

1.2、操作系统特征

- 并发

  指

### 1.5、系统调用

- 

## 进程

>  原语实现进程控制，特点就是执行期间不能中断，只能一气呵成，这种不可中断的操作叫做原子操作
>
> - 采用关**开中断指令**，只能在核心态

原语分析：

1. 更新PCB中的信息（修改进程状态标志、将运行环境保存到PCB、从PCB恢复运行环境

   a、所有进程控制原语一定都会修改进程状态标志

   b、剥夺当前运行进程的CPU使用权必然需要保存其运行环境

   c、某进程开始运行前必然要恢复其运行环境

2. 将PCB插入合适的队列
3. 分配/回收资源

### 2.1.4、进程通信

进程通信就是进程之间的信息交换，进程是分配系统资源的单位，各进程拥有的内存地址空间相互独立

为了保证安全，一个进程不允许直接访问另一个进程的地址空间

进程之间的信息交换就是必须实现的，为了安全性，操作系统提供了方法

- 共享存储，访问必须是互斥的（互斥访问是操作系统提供的工具实现）

  - 基于数据结构的共享：比如只能放一个长度为10的数组。缺点访问速度慢，限制多，**低级通信**方式
  - 基于存储区的共享：在内存中划分一块共享存储区，数据类型和存放位置由进程控制，共享速度快，**高级通信**方式

- 管道通信：内存中开辟一个大小固定的缓冲区，linux 4kb

  1. 管道只能采用半双工通信，某一时间段只能实现单向的传输，如果要实现双向同时通信，需要设置两个管道
  2. 各进程要**互斥**地访问管道
  3. 数据以字符流的形式写入管道，当管道写满时，写进程的write() 系统调用将被阻塞，等待读进程将数据取走。当读进程将数据全部取走后，管道变空，此时读进程的read()系统调用被阻塞
  4. 如果没写满，就不允许读。如果没读空，就不允许写
  5. 数据一旦被读出，就会被抛弃，意味着读进程最多只能有一个

- 消息传递：进程之间的数据交换以格式化的信息为单位，进程通过操作系统提供的"发送消息/接受消息"俩个原语进行数据交换

  - 消息分为消息头和消息体

  - 传递方式

    - 直接通信方式

      消息直接挂到接受进程的消息缓冲队列上

    - 间接通信方式

      消息要先发送到中间实体（信箱）中，因此也称为“信箱通信方式”。Eg：计网中的电子邮件系统

  - 传递方式：原语传送

  

  ### 线程、多线程模型

  线程是一个基本的CPU执行单元，也是程序执行流的最下单位。

  用户级线程

  内核级线程

  

  重点：内核级线程才是处理机分配的单位

  

  多对多的模型：n用户映射到m个内核级线程（n>=m)，每个用户进程对应m个内核级线程

  克服了多对一模型并发度不高的缺点，有克服了一对一模型一个用户进程占用太多内核级线程，开销太大的缺点。

  <img src="C:\Users\zfx\AppData\Roaming\Typora\typora-user-images\image-20220314203456340.png" alt="image-20220314203456340" style="zoom: 40%;" />

  

   

  ### 2.2处理机调度

  #### 2.2.1、处理机的概念、层次

  处理机调度：从就绪队列中按照一定的算法选择一个进程并将处理机分配给它运行，以实现进程的并发执行

  - 高级调度（作业调度）：从**外存**的后备队列中选择一个或者多个作业，给他们分配**内存**等资源，建立相对应的进程（PCB），辅存到内存之间的调度，作业调入会建立相对应的PCB，作业调出才撤销PCB
  - 中级调度

  

  #### 2.2.2进程调度的时机

  进程调度（低级调度），就是按照某种算法从就绪队列中选择一个进程为其分配处理机

  需要进行进程调度的情况：

  - 当前进行的进程主动放弃处理机
    - 进程正常终止
    - 运行进程发生了异常而终止
    - 进程主动阻塞（如：请求I/O）
  - 当前运行的进程被动放弃处理机
    - 分给进程的时间片用完
    - 有更紧急的事需处理（如：I/O中断）
    - 有更优先级的进程进入了就绪队列

  不能进行进程调度和切换的情况：

  1. 在处理中断过程中
  2. 进程在**操作系统内核**程序临界区
  3. 在原子操作过程中（原语）

#### 2.2.3调度算法的评价指标

CPU：利用率 忙碌时间/总时间

系统吞吐量：单位时间完成作业的数量

系统吞吐量：完成作业/完成时间

> 例：某计算机系统处理完10道作业，花费100秒，系统吞吐量为？
>
> **0.1道/秒**

周转时间：作业被提交给系统开始，到作业完成为止的这段时间时间间隔

#### 2.2.4调度算法



调度算法：

- 先来先服务
- 短作业优先
- 高响应比优先

学习思路：

1. 算法思想

2. 算法规则
3. 算法用于作业调度还是进程调度
4.  

3. 请求和保持
4. 循环等待条件

预防死锁

避免死锁

